<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Easing: 4 sentence introEasing is how an animation moves from initial state to completion over time. Easing is described by an equation or set of equations. Using easing will make your animation look">
<meta name="keywords" content="javascript,caching">
<meta property="og:type" content="article">
<meta property="og:title" content="Ease your cache">
<meta property="og:url" content="https://pajtai.github.io/ease-your-cache/index.html">
<meta property="og:site_name" content="Peter Ajtai">
<meta property="og:description" content="Easing: 4 sentence introEasing is how an animation moves from initial state to completion over time. Easing is described by an equation or set of equations. Using easing will make your animation look">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2013-01-13T08:00:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ease your cache">
<meta name="twitter:description" content="Easing: 4 sentence introEasing is how an animation moves from initial state to completion over time. Easing is described by an equation or set of equations. Using easing will make your animation look">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Ease your cache</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/build-automation/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/do-not-stop-not-thinking-negatively/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://pajtai.github.io/ease-your-cache/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://pajtai.github.io/ease-your-cache/&text=Ease your cache"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://pajtai.github.io/ease-your-cache/&title=Ease your cache"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://pajtai.github.io/ease-your-cache/&is_video=false&description=Ease your cache"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Ease your cache&body=Check out this article: https://pajtai.github.io/ease-your-cache/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://pajtai.github.io/ease-your-cache/&title=Ease your cache"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://pajtai.github.io/ease-your-cache/&title=Ease your cache"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://pajtai.github.io/ease-your-cache/&title=Ease your cache"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://pajtai.github.io/ease-your-cache/&title=Ease your cache"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://pajtai.github.io/ease-your-cache/&name=Ease your cache&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Easing-4-sentence-intro"><span class="toc-number">1.</span> <span class="toc-text">Easing: 4 sentence intro</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Caching"><span class="toc-number">2.</span> <span class="toc-text">Caching</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Ease your cache
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Peter Ajtai</span>
      </span>
      
    <div class="postdate">
        <time datetime="2013-01-13T08:00:00.000Z" itemprop="datePublished">2013-01-13</time>
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/caching/">caching</a>, <a class="tag-link" href="/tags/javascript/">javascript</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="Easing-4-sentence-intro"><a href="#Easing-4-sentence-intro" class="headerlink" title="Easing: 4 sentence intro"></a>Easing: 4 sentence intro</h2><p>Easing is how an animation moves from initial state to completion over time. Easing is described by an equation or set of
equations. Using easing will make your animation look more polished and appealing.</p>
<p><a href="http://easings.net/" target="_blank" rel="noopener">Here</a> are visualization for several easing equations.</p>
<h2 id="Caching"><a href="#Caching" class="headerlink" title="Caching"></a>Caching</h2><p>Easing functions can get pretty complicated. They often include notoriously slow methods like sine or cosine. This
means that you should cache your easing results.</p>
<p>The problem is that if your easing equations are not normalized to one unit of time and one unit of completion, then
this caching will not be useful.</p>
<p>In other words, pass in only a normalized <code>t</code>, so that you have the maximum chance of hitting a cached <code>y</code>. Basically,
we’re drawing a curve, and once we calculate a point on that curve, we want to cache our calculation. If we don’t
normalize our easing equation then we must draw many curves, but if we do normalize then we only need one curve, and
so we can store points on that single curve from all our animations that share the same easing function.</p>
<p>Below is an example for easing in and out with a sine function:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">easeInOutSine = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Our cache in a closure</span></span><br><span class="line">    <span class="keyword">var</span> cache = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The actual easing function returned to the user</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If the value is not in the cache, put it in the cache</span></span><br><span class="line">    <span class="keyword">if</span> (! cache[t]) &#123;</span><br><span class="line">       cache[t] = <span class="number">-1</span>/<span class="number">2</span> * (<span class="built_in">Math</span>.cos(<span class="built_in">Math</span>.PI * t) - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// We return from the cache, knowing our value is there</span></span><br><span class="line">    <span class="keyword">return</span> cache[t];</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure>
<p><a href="http://jsfiddle.net/pajtai/VX5xK/show/" target="_blank" rel="noopener"><strong>jsFiddle using the above</strong></a> - (<a href="http://jsfiddle.net/pajtai/VX5xK/" target="_blank" rel="noopener">code</a>)</p>
<p>Or, if you are an <a href="http://underscorejs.org/" target="_blank" rel="noopener">underscore</a> fan:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use underscores built in memoize for caching</span></span><br><span class="line">easeInOutSine: _.memoize(<span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>/<span class="number">2</span> * (<span class="built_in">Math</span>.cos(<span class="built_in">Math</span>.PI*t) - <span class="number">1</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><a href="http://jsfiddle.net/pajtai/8kU85/show/" target="_blank" rel="noopener"><strong>jsFiddle using the above</strong></a> - (<a href="http://jsfiddle.net/pajtai/8kU85/" target="_blank" rel="noopener">code</a>)</p>
<p>This complicates your animation equation, since you have to normalize your time and change intervals, but the
payoff is a smoother animation, since you’re doing fewer computations.</p>
<p>The above is better for caching then for example something like:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This is hard to cache, since there's going to be cache entries for each combination of arguments</span></span><br><span class="line">easeInOutSine: <span class="function"><span class="keyword">function</span> (<span class="params">startValue, changeInValue, msElapsed, msDuration</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> -changeInValue/<span class="number">2</span> * (<span class="built_in">Math</span>.cos(<span class="built_in">Math</span>.PI * msElapsed/msDuration) - <span class="number">1</span>) + startValue;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>Normalizing your easing equations to improve caching is fine and dandy, but it certainly isn’t very user friendly unless
your easing equation or animation engine handles the normalization. Then you can go back to having nice arguments.</p>
<p>The disadvantage of rolling your normalization into your easing equation is that you have to recalculate the change
in value from the start and end value at each tick. Also, it doesn’t seem like normalization is a job for an easing
 equation. So, let’s put the normalization into the animation engine.</p>
<p>For example, adding normalization to <code>easeInOutSine</code> and moving a box around would make something like:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The animation equation with user friendly arguments</span></span><br><span class="line"><span class="comment">// This will take care of normalization before calling the easing equation,</span></span><br><span class="line"><span class="comment">// * tickHook - function that get called on each tick with the updated number</span></span><br><span class="line"><span class="comment">// * startNum - initial value</span></span><br><span class="line"><span class="comment">// * endNum - final value</span></span><br><span class="line"><span class="comment">// * duration - how long animation last in milliseconds</span></span><br><span class="line"><span class="comment">// * callback - (optional) function to call when animation finishes</span></span><br><span class="line"><span class="comment">// * easingEq - (optional) easing equation</span></span><br><span class="line">    <span class="keyword">var</span> animate = <span class="function"><span class="keyword">function</span> (<span class="params">tickHook, startNum, endNum, duration, callback, easingEq</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> easingEq = easingEq || easing.easeInOutSine,</span><br><span class="line">            changeInNum = endNum - startNum,</span><br><span class="line">            startTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(),</span><br><span class="line"></span><br><span class="line">            <span class="comment">// The engine that runs the animation</span></span><br><span class="line">            engine = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(),</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Calculate the normalized time elapsed for the easing function</span></span><br><span class="line">                    timeNorm = (now - startTime) / duration,</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Calculate the normalized completion from the normalized time</span></span><br><span class="line">                    <span class="comment">// using the easing function</span></span><br><span class="line">                    completionNorm = easingEq(timeNorm),</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// "un-normalize" to calculate the new actual number</span></span><br><span class="line">                    newNum = startNum + completionNorm * changeInNum;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (now - startTime &gt; duration) &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (callback) &#123;</span><br><span class="line">                        callback();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Update interested parties with the new number once per tick</span></span><br><span class="line">                    tickHook(newNum);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Kick off the next tick</span></span><br><span class="line">                    requestAnimationFrame(engine);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">        requestAnimationFrame(engine);</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="comment">// and the implentation goes here...</span></span><br></pre></td></tr></table></figure>
<p><a href="http://jsfiddle.net/pajtai/gAAp2/show" target="_blank" rel="noopener"><strong>jsFiddle example</strong></a> (<a href="http://jsfiddle.net/pajtai/gAAp2/" target="_blank" rel="noopener">code</a>)</p>
<p>In fact the caching could probably move out of the easing equation too in order to keep the equation clean. You can
roll your own caching (a.k.a. memoization) function, or you can use something like <a href="http://underscorejs.org/#memoize" target="_blank" rel="noopener"><strong>Underscore’s memoize</strong></a>.</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Easing-4-sentence-intro"><span class="toc-number">1.</span> <span class="toc-text">Easing: 4 sentence intro</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Caching"><span class="toc-number">2.</span> <span class="toc-text">Caching</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://pajtai.github.io/ease-your-cache/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://pajtai.github.io/ease-your-cache/&text=Ease your cache"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://pajtai.github.io/ease-your-cache/&title=Ease your cache"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://pajtai.github.io/ease-your-cache/&is_video=false&description=Ease your cache"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Ease your cache&body=Check out this article: https://pajtai.github.io/ease-your-cache/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://pajtai.github.io/ease-your-cache/&title=Ease your cache"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://pajtai.github.io/ease-your-cache/&title=Ease your cache"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://pajtai.github.io/ease-your-cache/&title=Ease your cache"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://pajtai.github.io/ease-your-cache/&title=Ease your cache"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://pajtai.github.io/ease-your-cache/&name=Ease your cache&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2020 Peter Ajtai
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">Tags</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>

<script src=https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML></script>
</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-4145174-19', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


